import{b as Ve,g as c,d as G,r as Ue,a as Re,p as We,I as re,c as Ae,e as ee,i as je,m as fe,s as be,E as He,f as ze,h as Ye,j as Ge,k as Je,l as Xe,n as Ke,o as Qe,q as Ze,t as H,u as te,v as et,w as tt,x as N,y as nt,z as at,L as rt,A as st,S as ot,B as it,C as lt,P as ut,D as ct,R as dt,F as _e,G as ge,H as ft,J as pt,K as vt,M as Ie,N as $e,O as Y,Q as bt,T as _t,U as Oe,V as W,W as se,X as R,Y as q,Z as Te,_ as V,$ as me,a0 as oe,a1 as he,a2 as gt,a3 as mt}from"./legacy-DCYbLtyV.js";import{p as ht,R as P}from"./interfaces-D03hLfJa.js";let Le=!1;function ye(e,t){return t}function yt(e,t,a,r){for(var i=[],f=t.length,m=0;m<f;m++)ze(t[m].e,i,!0);var h=f>0&&i.length===0&&a!==null;if(h){var p=a.parentNode;Ye(p),p.append(a),r.clear(),B(e,t[0].prev,t[f-1].next)}Ge(i,()=>{for(var b=0;b<f;b++){var l=t[b];h||(r.delete(l.k),B(e,l.prev,l.next)),Je(l.e,!h)}})}function we(e,t,a,r,i,f=null){var m=e,h={items:new Map,first:null},p=null,b=!1,l=G(()=>{var _=a();return Ze(_)?_:_==null?[]:Ae(_)});Ve(()=>{var _=c(l),v=_.length;b&&v===0||(b=v===0,wt(_,h,m,i,t,r,a),f!==null&&(v===0?p?Ue(p):p=Re(()=>f(m)):p!==null&&We(p,()=>{p=null})),c(l))})}function wt(e,t,a,r,i,f,m){var h=e.length,p=t.items,b=t.first,l=b,_,v=null,k=[],w=[],$,T,x,U;for(U=0;U<h;U+=1){if($=e[U],T=f($,U),x=p.get(T),x===void 0){var C=l?l.e.nodes_start:a;v=kt(C,t,v,v===null?t.first:v.next,$,T,U,r,i,m),p.set(T,v),k=[],w=[],l=v.next;continue}if(xt(x,$,U),x.e.f&re&&Ue(x.e),x!==l){if(_!==void 0&&_.has(x)){if(k.length<w.length){var L=w[0],S;v=L.prev;var D=k[0],n=k[k.length-1];for(S=0;S<k.length;S+=1)xe(k[S],L,a);for(S=0;S<w.length;S+=1)_.delete(w[S]);B(t,D.prev,n.next),B(t,v,D),B(t,n,L),l=L,v=n,U-=1,k=[],w=[]}else _.delete(x),xe(x,l,a),B(t,x.prev,x.next),B(t,x,v===null?t.first:v.next),B(t,v,x),v=x;continue}for(k=[],w=[];l!==null&&l.k!==T;)l.e.f&re||(_??(_=new Set)).add(l),w.push(l),l=l.next;if(l===null)continue;x=l}k.push(x),v=x,l=x.next}if(l!==null||_!==void 0){for(var s=_===void 0?[]:Ae(_);l!==null;)l.e.f&re||s.push(l),l=l.next;var o=s.length;if(o>0){var u=null;yt(t,s,u,p)}}ee.first=t.first&&t.first.e,ee.last=v&&v.e}function xt(e,t,a,r){je(e.v,t),e.i=a}function kt(e,t,a,r,i,f,m,h,p,b){var l=(p&Ke)!==0,_=(p&Qe)===0,v=l?_?fe(i):be(i):i,k=p&He?be(m):m,w={i:k,v,k:f,a:null,e:null,prev:a,next:r};try{return w.e=Re(()=>h(e,v,k,b),Le),w.e.prev=a&&a.e,w.e.next=r&&r.e,a===null?t.first=w:(a.next=w,a.e.next=w.e),r!==null&&(r.prev=w,r.e.prev=w.e),w}finally{}}function xe(e,t,a){for(var r=e.next?e.next.e.nodes_start:a,i=t?t.e.nodes_start:a,f=e.e.nodes_start;f!==r;){var m=Xe(f);i.before(f),f=m}}function B(e,t,a){t===null?e.first=a:(t.next=a,t.e.next=a&&a.e),a!==null&&(a.prev=t,a.e.prev=t&&t.e)}function Pe(e){var t,a,r="";if(typeof e=="string"||typeof e=="number")r+=e;else if(typeof e=="object")if(Array.isArray(e)){var i=e.length;for(t=0;t<i;t++)e[t]&&(a=Pe(e[t]))&&(r&&(r+=" "),r+=a)}else for(a in e)e[a]&&(r&&(r+=" "),r+=a);return r}function St(){for(var e,t,a=0,r="",i=arguments.length;a<i;a++)(e=arguments[a])&&(t=Pe(e))&&(r&&(r+=" "),r+=t);return r}function ie(e){return typeof e=="object"?St(e):e??""}function le(e,t,a){var r=e.__className,i=Et(t);(r!==i||Le)&&(t==null?e.removeAttribute("class"):e.className=i,e.__className=i)}function Et(e,t){return(e??"")+""}function De(e,t,a){if(e==null)return t(void 0),H;const r=te(()=>e.subscribe(t,a));return r.unsubscribe?()=>r.unsubscribe():r}const j=[];function ke(e,t=H){let a=null;const r=new Set;function i(h){if(et(e,h)&&(e=h,a)){const p=!j.length;for(const b of r)b[1](),j.push(b,e);if(p){for(let b=0;b<j.length;b+=2)j[b][0](j[b+1]);j.length=0}}}function f(h){i(h(e))}function m(h,p=H){const b=[h,p];return r.add(b),r.size===1&&(a=t(i,f)||H),h(e),()=>{r.delete(b),r.size===0&&a&&(a(),a=null)}}return{set:i,update:f,subscribe:m}}function ce(e){let t;return De(e,a=>t=a)(),t}let Z=!1,de=Symbol();function Ut(e,t,a){const r=a[t]??(a[t]={store:null,source:fe(void 0),unsubscribe:H});if(r.store!==e&&!(de in a))if(r.unsubscribe(),r.store=e??null,e==null)r.source.v=void 0,r.unsubscribe=H;else{var i=!0;r.unsubscribe=De(e,f=>{i?r.source.v=f:N(r.source,f)}),i=!1}return e&&de in a?ce(e):c(r.source)}function Rt(){const e={};function t(){tt(()=>{for(var a in e)e[a].unsubscribe();nt(e,de,{enumerable:!1,value:!0})})}return[e,t]}function At(e,t,a){return e.set(a),t}function It(e){var t=Z;try{return Z=!1,[e(),Z]}finally{Z=t}}function Se(e){for(var t=ee,a=ee;t!==null&&!(t.f&(ct|dt));)t=t.parent;try{return _e(t),e()}finally{_e(a)}}function $t(e,t,a,r){var D;var i=(a&vt)!==0,f=!lt||(a&ut)!==0,m=(a&ft)!==0,h=!1,p;[p,h]=It(()=>e[t]);var b=ot in e||it in e,l=(((D=at(e,t))==null?void 0:D.set)??(b&&t in e&&(n=>e[t]=n)))||void 0,_=r,v=!0,k=!1,w=()=>(k=!0,v&&(v=!1,_=r),_),$;if(f)$=()=>{var n=e[t];return n===void 0?w():(v=!0,k=!1,n)};else{var T=Se(()=>(i?ge:G)(()=>e[t]));T.f|=rt,$=()=>{var n=c(T);return n!==void 0&&(_=void 0),n===void 0?_:n}}if(l){var x=e.$$legacy;return function(n,s){return arguments.length>0?((!f||!s||x||h)&&l(s?$():n),n):$()}}var U=!1,C=!1,L=fe(p),S=Se(()=>ge(()=>{var n=$(),s=c(L);return U?(U=!1,C=!0,s):(C=!1,L.v=n)}));return S.equals=st,function(n,s){if(pt!==null&&(U=C,$(),c(L)),arguments.length>0){const o=s?c(S):f&&m?ht(n):n;return S.equals(o)||(U=!0,N(L,o),k&&_!==void 0&&(_=o),te(()=>c(S))),n}return c(S)}}const Me=(e,t)=>{switch(e){case P.afktimer:case P.buff:case P.model:case P.stat:return!1;case P.chat:case P.popup:return;case P.xpgain:return t?!1:void 0}},I=[];for(let e=0;e<256;++e)I.push((e+256).toString(16).slice(1));function Ot(e,t=0){return(I[e[t+0]]+I[e[t+1]]+I[e[t+2]]+I[e[t+3]]+"-"+I[e[t+4]]+I[e[t+5]]+"-"+I[e[t+6]]+I[e[t+7]]+"-"+I[e[t+8]]+I[e[t+9]]+"-"+I[e[t+10]]+I[e[t+11]]+I[e[t+12]]+I[e[t+13]]+I[e[t+14]]+I[e[t+15]]).toLowerCase()}let ue;const Tt=new Uint8Array(16);function Lt(){if(!ue){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");ue=crypto.getRandomValues.bind(crypto)}return ue(Tt)}const Pt=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Ee={randomUUID:Pt};function ne(e,t,a){var i;if(Ee.randomUUID&&!e)return Ee.randomUUID();e=e||{};const r=e.random??((i=e.rng)==null?void 0:i.call(e))??Lt();if(r.length<16)throw new Error("Random bytes length must be >= 16");return r[6]=r[6]&15|64,r[8]=r[8]&63|128,Ot(r)}const Dt=()=>fetch("https://bolt-api/send-message",{method:"POST",body:new Uint8Array([1,0])});var Mt=(e,t,a)=>t(c(a),!1),Ct=W('<button class="h-[14px] w-[14px] pointer-events-auto"><img src="plugin://app/images/caret-down-solid.svg" class="w-full h-full" alt="Hide"></button>'),Nt=(e,t,a)=>t(c(a),!0),Ft=W('<button class="h-[14px] w-[14px] pointer-events-auto"><img src="plugin://app/images/caret-down-solid.svg" class="w-full h-full rotate-270" alt="Expand"></button>'),qt=(e,t,a)=>t(c(a)),Bt=(e,t,a)=>t(c(a)),Vt=(e,t,a)=>t(c(a)),Wt=(e,t,a,r)=>t(c(a),c(r)),jt=(e,t,a,r)=>t(c(a),c(r)),Ht=W('<div> <button class="absolute rounded-lg right-0 top-0 h-[18px] w-[18px] hover:bg-red-500 pointer-events-auto py-0 by-0" title="Delete"><img src="plugin://app/images/xmark-solid.svg" class="w-full h-full" alt="Delete"></button> <button class="absolute rounded-lg right-[18px] top-0 h-[18px] w-[18px] hover:bg-blue-400 pointer-events-auto py-0 by-0" title="Edit"><img src="plugin://app/images/gear-solid.svg" class="absolute top-[2px] left-[2px] w-[14px] h-[14px]" alt="Edit"></button></div>'),zt=W('<div><!> <button class="absolute rounded-lg right-0 top-0 h-[18px] w-[18px] hover:bg-red-500 pointer-events-auto py-0 by-0" title="Delete"><img src="plugin://app/images/xmark-solid.svg" class="w-full h-full" alt="Delete"></button> <button class="absolute rounded-lg right-[18px] top-0 h-[18px] w-[18px] hover:bg-blue-400 pointer-events-auto py-0 by-0" title="Edit"><img src="plugin://app/images/gear-solid.svg" class="absolute top-[2px] left-[2px] w-[14px] h-[14px]" alt="Edit"></button> <button class="absolute rounded-lg right-[36px] top-0 h-[18px] w-[18px] hover:bg-emerald-400 pointer-events-auto py-0 by-0" title="Add rule"><img src="plugin://app/images/plus-solid.svg" class="w-full h-full" alt="Add rule"></button></div> <!>',1),Yt=(e,t)=>N(t,!0),Gt=W("<button>Enable sounds</button>"),Jt=W('<div><!> <!> <button class="rounded-sm m-1 px-2 py-1 bg-emerald-400 pointer-events-auto hover:opacity-75">Add ruleset</button></div>');function Xt(e,t){$e(t,!1);const[a,r]=Rt(),i=()=>Ut(l(),"$list",a);let f=Y(!1),m=Y(!0);setInterval(()=>{N(m,!c(m))},350);const h=(n,s)=>{let o=0;const u=g=>{s&&s.setUint8(o,g?1:0),o+=1},d=g=>{s&&s.setUint32(o,g,!0),o+=4},E=g=>{s&&s.setInt32(o,g,!0),o+=4},A=g=>{const y=new TextEncoder().encode(g);if(d(g.length),s)for(let O=0;O<y.byteLength;O+=1)s.setUint8(o+O,y[O]);o+=y.byteLength};d(n.length);for(const g of n){A(g.id),u(g.alert),u(g.doFlashWindow),u(g.onlyIfUnfocused),d(Object.keys(g.rules).length);for(const y of Object.values(g.rules)){A(y.id),A(y.ruletype);const O=typeof y.alert=="boolean",z=typeof y.number=="number",J=typeof y.ref=="string",X=typeof y.comparator=="string",K=typeof y.find=="string";u(O),O&&u(y.alert===!0),u(z),z&&E(y.number),u(J),J&&A(y.ref),u(X),X&&A(y.comparator),u(K),K&&A(y.find)}}return o};window.addEventListener("message",n=>{if(!n.data||typeof n.data!="object"||n.data.type!=="pluginMessage")return;const s=new Uint16Array(n.data.content.slice(0,2))[0];switch(s){case 1:{const o=new URLSearchParams(new TextDecoder().decode(n.data.content.slice(2)));let u=o.get("id"),d=null;u?d=ce(l())[u]:u=ne(),At(l(),te(i)[u]={id:u,name:o.get("name"),rules:d?d.rules:{},expanded:d?d.expanded:!1,alert:d?d.alert:!1,doFlashWindow:o.get("flash_window")==="1",sound:o.get("sound")??void 0,volume:parseInt(o.get("volume")),onlyIfUnfocused:o.get("only_if_unfocused")==="1"},te(i));break}case 2:{const o=new URLSearchParams(new TextDecoder().decode(n.data.content.slice(2))),u=i(),d=u[o.get("ruleset_id")];let E=o.get("id"),A=null;E?A=d.rules[E]:E=ne();const g=o.get("number"),y=o.get("type");d.rules[E]={id:E,ruletype:y,alert:A?A.alert:Me(y,!!g),number:g?parseInt(g):void 0,ref:o.get("ref")??void 0,comparator:o.get("comparator")??void 0,find:o.get("find")??void 0},d.expanded=!0,l().set(u);break}case 3:{const o=i(),u=new URLSearchParams(new TextDecoder().decode(n.data.content.slice(2))),d=o[u.get("ruleset_id")],E=d.rules[u.get("rule_id")],A=u.get("alert")==="1",g=typeof E.alert=="boolean";g&&(E.alert=A);let y=!1;for(let O of Object.values(d.rules))O.alert&&(y=!0);if((y&&!d.alert||A&&!g)&&d.sound&&c(f)){const O=new Audio("plugin://app/sounds/".concat(d.sound));O.volume=Math.min(Math.max(d.volume/100,0),1),O.play()}d.alert=y,N(p,!1),N(b,!1),l().set(o);break}default:console.error(`unknown message type ${s}`)}});let p=Y(!1),b=Y(!0),l=$t(t,"list",12);const _=n=>{let s={id:n.id,name:n.name,only_if_unfocused:n.onlyIfUnfocused?"1":"0",flash_window:n.doFlashWindow?"1":"0",volume:n.volume.toString()};n.sound&&(s.sound=n.sound);const o="\0".concat(new URLSearchParams(s).toString());fetch("https://bolt-api/send-message",{method:"POST",body:o})},v=n=>{let s={ruleset_id:n.id};const o="\0".concat(new URLSearchParams(s).toString());fetch("https://bolt-api/send-message",{method:"POST",body:o})},k=(n,s)=>{let o={ruleset_id:n.id,id:s.id,type:s.ruletype};s.number&&(o.number=s.number.toString()),s.ref&&(o.ref=s.ref),s.comparator&&(o.comparator=s.comparator),s.find&&(o.find=s.find);const u="\0".concat(new URLSearchParams(o).toString());fetch("https://bolt-api/send-message",{method:"POST",body:u})},w=n=>{const s=ce(l());delete s[n.id],l().set(s)},$=(n,s)=>{delete n.rules[s.id],l().set(i())},T=(n,s)=>{n.expanded=s,l(l())},x=n=>{switch(n.ruletype){case P.afktimer:return typeof n.number!="number"?"afk timer":`afk timer (${Math.floor(n.number/1e6)} sec)`;case P.buff:switch(n.comparator){case"active":return`buff '${n.ref}' active`;case"inactive":return`buff '${n.ref}' inactive`;case"lessthan":return`buff '${n.ref}' < ${n.number}`;case"greaterthan":return`buff '${n.ref}' > ${n.number}`;case"parenslessthan":return`buff '${n.ref}' parentheses < ${n.number}`;case"parenscreaterthan":return`buff '${n.ref}' parentheses > ${n.number}`;default:return`buff '${n.ref}'`}case P.chat:return`chat text: '${n.find}'`;case P.model:return`3D model: '${n.ref}'`;case P.popup:return`popup text: '${n.find}'`;case P.stat:return typeof n.number!="number"?`stat '${n.ref}'`:`stat '${n.ref}' < ${n.number}%`;case P.xpgain:return typeof n.number!="number"?"xp gain":`xp gain timeout (${Math.floor(n.number/1e6)} sec)`;default:return"unknown"}};bt(()=>(i(),c(b),c(p)),()=>{const n=i();if(c(b)&&(c(p)||Object.keys(n).length>0)){const s=Object.values(n),o=h(s,null),u=new ArrayBuffer(o+2);new DataView(u,0,2).setUint16(0,5,!0),h(s,new DataView(u,2,o)),fetch("https://bolt-api/send-message",{method:"POST",body:u})}if(c(p)){const s=Object.values(n).map(u=>({name:u.name,rules:Object.values(u.rules).map(d=>({ruletype:d.ruletype,number:d.number,ref:d.ref,comparator:d.comparator,find:d.find})),doFlashWindow:u.doFlashWindow,sound:u.sound,volume:u.volume,onlyIfUnfocused:u.onlyIfUnfocused})),o="\0".concat(JSON.stringify(s));fetch("https://bolt-api/send-message",{method:"POST",body:o})}else N(p,!0);N(b,!0)}),_t(),Oe();var U=Jt(),C=V(U);we(C,1,()=>Object.values(i()),ye,(n,s,o)=>{var u=zt(),d=me(u),E=V(d);{var A=M=>{var F=Ct();F.__click=[Mt,T,s],q(M,F)},g=M=>{var F=Ft();F.__click=[Nt,T,s],q(M,F)};se(E,M=>{c(s).expanded?M(A):M(g,!1)})}var y=R(E),O=R(y);O.__click=[qt,w,s];var z=R(O,2);z.__click=[Bt,_,s];var J=R(z,2);J.__click=[Vt,v,s];var X=R(d,2);{var K=M=>{var F=gt(),Ce=me(F);we(Ce,1,()=>Object.values(c(s).rules),ye,(Ne,Q)=>{var ae=Ht(),pe=V(ae),ve=R(pe);ve.__click=[Wt,$,s,Q];var Fe=R(ve,2);Fe.__click=[jt,k,s,Q],oe((qe,Be)=>{le(ae,ie(qe)),he(pe,`${Be??""} `)},[()=>"relative px-1 w-full text-[8pt] ".concat(c(Q).alert&&c(m)?"bg-red-400":o&1?"bg-gray-200":"bg-gray-300"),()=>x(c(Q))],G),q(Ne,ae)}),q(M,F)};se(X,M=>{c(s).expanded&&M(K)})}oe(M=>{le(d,ie(M)),he(y,` ${c(s).name??""} `)},[()=>"relative w-full text-[8pt] ".concat(c(s).alert&&c(m)?"bg-red-400":o&1?"bg-gray-200":"bg-gray-300")],G),q(n,u)});var L=R(C,2);{var S=n=>{var s=Gt();s.__click=[Yt,f],oe(o=>le(s,ie(o)),[()=>"rounded-sm m-1 px-2 py-1 pointer-events-auto hover:opacity-75 ".concat(c(m)?"bg-red-400":"bg-blue-400")],G),q(n,s)};se(L,n=>{c(f)||n(S)})}var D=R(L,2);D.__click=[Dt],q(e,U),Te(),r()}Ie(["click"]);const Kt=()=>fetch("https://bolt-api/close-request");var Qt=(e,t)=>{e.button===0&&t("-1","-1")},Zt=(e,t)=>{e.button===0&&t("0","-1")},en=(e,t)=>{e.button===0&&t("1","-1")},tn=(e,t)=>{e.button===0&&t("-1","0")},nn=(e,t)=>{e.button===0&&t("1","0")},an=(e,t)=>{e.button===0&&t("-1","1")},rn=(e,t)=>{e.button===0&&t("0","1")},sn=(e,t)=>{e.button===0&&t("1","1")},on=(e,t)=>{e.button===0&&t("0","0")},ln=W('<main><div class="absolute grid grid-cols-[5px_auto_5px] grid-rows-[5px_auto_5px] top-0 left-0 bottom-0 right-0 z-100 pointer-events-none"><div class="bg-black pointer-events-auto select-none"></div> <div class="bg-black pointer-events-auto select-none"></div> <div class="bg-black pointer-events-auto select-none"></div> <div class="bg-black pointer-events-auto select-none"></div> <div class="pointer-events-none"></div> <div class="bg-black pointer-events-auto select-none"></div> <div class="bg-black pointer-events-auto select-none"></div> <div class="bg-black pointer-events-auto select-none"></div> <div class="bg-black pointer-events-auto select-none"></div></div> <div class="m-[7px] w-auto h-auto"><div class="m-0 p-0 border-b border-black absolute top-[5px] right-[5px] w-[18px] h-[19px]"><button class="m-0 p-0 absolute top-0 left-0 w-full h-full select-none text-center text-[12px] bg-[hsl(0,70%,50%)] hover:bg-[hsl(0,100%,50%)]">X</button></div> <div class="m-0 p-0 border-b border-black absolute left-[5px] top-[5px] right-[23px] h-[19px] bg-[grey] text-center text-[10pt]"><p class="m-0 p-0 color-black select-none pointer-events-none">Alerts</p></div> <div class="fixed top-[24px] bottom-[6px] left-[5px] right-[5px] text-[10pt] pointer-events-none"><!></div></div></main>');function un(e,t){$e(t,!1);const a=new URLSearchParams(window.location.search);let r=Y((S=>{const D=S.get("list");if(!D)return ke({});const n=JSON.parse(atob(D));let s={};for(const o of n){let u={};for(const E of o.rules){const A=ne(),g=E.ruletype;u[A]={id:A,ruletype:g,alert:Me(g,!!E.number),number:E.number,ref:E.ref,comparator:E.comparator,find:E.find}}const d=ne();s[d]={id:d,name:o.name,rules:u,expanded:!1,alert:!1,doFlashWindow:o.doFlashWindow,sound:o.sound,volume:o.volume,onlyIfUnfocused:o.onlyIfUnfocused}}return ke(s)})(a));const i=(S,D)=>fetch("https://bolt-api/start-reposition?".concat(new URLSearchParams({h:S,v:D}).toString()));Oe();var f=ln(),m=V(f),h=V(m);h.__mousedown=[Qt,i];var p=R(h,2);p.__mousedown=[Zt,i];var b=R(p,2);b.__mousedown=[en,i];var l=R(b,2);l.__mousedown=[tn,i];var _=R(l,4);_.__mousedown=[nn,i];var v=R(_,2);v.__mousedown=[an,i];var k=R(v,2);k.__mousedown=[rn,i];var w=R(k,2);w.__mousedown=[sn,i];var $=R(m,2),T=V($),x=V(T);x.__click=[Kt];var U=R(T,2);U.__mousedown=[on,i];var C=R(U,2),L=V(C);Xt(L,{get list(){return c(r)},set list(S){N(r,S)},$$legacy:!0}),q(e,f),Te()}Ie(["mousedown","click"]);mt(un,{target:document.body});
